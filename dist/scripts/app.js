var app=angular.module("app",["ngRoute","ngResource","ngAnimate","ngCookies","ngSanitize","ngTouch"]);app.config(["$httpProvider","$routeProvider","$locationProvider",function(e,t,i){t.when("/save-the-princess",{action:"home"}).when("/save-the-princess/instruction",{action:"instruction"}).when("/save-the-princess/game",{action:"game"}).otherwise({redirectTo:"/"}),window.history&&window.history.pushState&&i.html5Mode(!0)}]),app.controller("gameController",["$scope","$route","$routeParams",function(e,t){function i(){l=document.getElementById("canvas"),d=l.getContext("2d"),a=800,s="playing",u=600,c={color:"#B9DAFB",x:0,y:u/2,width:30,height:30,speed:6,velX:0,velY:0,jumping:!1,grounded:!1,facing:"right",shot:!1},g={color:"#F5ABC7",width:30,height:30,x:a-31,y:50},p=[],w=[],y=[],v=[],x={color:"#FDDD32",width:10,height:10,x:-10,y:-10,speed:8,direction:null},f={x:-10,y:-10,width:10,height:10,speed:8,mortal:!1},m=.8,$=.8,b={color:"#E3504B",x:120,y:200,width:40,height:40,speed:4,direction:"down",alive:!0,mortal:!0},R={x:316,y:360,width:40,height:40,speed:2,direction:"right",alive:!0,mortal:!0},S={x:556,y:40,width:40,height:40,speed:2,direction:"left",alive:!0,mortal:!0},A={x:316,y:200,width:40,height:40,alive:!0,mortal:!0,shot:!1},C={x:266,y:u-40,width:a-266,height:40,mortal:!1},v.push(b),v.push(C),v.push(R),v.push(S),v.push(A),v.push(f),y.push({x:276,y:360,width:40,height:40}),y.push({x:516,y:360,width:40,height:40}),y.push({x:356,y:40,width:40,height:40}),y.push({x:596,y:40,width:40,height:40}),w.push({x:0,y:0,width:1,height:u}),w.push({x:0,y:u-2,width:a,height:50}),w.push({x:a-1,y:0,width:1,height:u}),w.push({x:0,y:0,width:266,height:200}),w.push({x:0,y:400,width:266,height:200}),w.push({x:316,y:400,width:200,height:40}),w.push({x:606,y:400,width:200,height:40}),w.push({x:646,y:360,width:160,height:40}),w.push({x:686,y:320,width:120,height:40}),w.push({x:606,y:240,width:120,height:40}),w.push({x:396,y:280,width:120,height:40}),w.push({x:316,y:240,width:40,height:40}),w.push({x:356,y:160,width:40,height:40}),w.push({x:396,y:80,width:200,height:40}),w.push({x:646,y:80,width:160,height:40}),l.width=a,l.height=u}function h(){(p[38]||p[87])&&!c.jumping&&c.grounded&&(c.jumping=!0,c.grounded=!1,c.velY=2*-c.speed),(p[39]||p[68])&&(c.facing="right",c.velX<c.speed&&c.velX++),(p[37]||p[65])&&(c.velX>-c.speed&&c.velX--,c.facing="left"),p[32]&&("win"===s?i():c.shot===!1&&(c.shot=!0,x.direction=c.facing,x.x=c.x+30,x.y=c.y+10)),c.velX*=m,c.velY+=$,d.clearRect(0,0,a,u),d.fillStyle="black",d.beginPath(),c.grounded=!1;for(var e=0;e<w.length;e++){d.rect(w[e].x,w[e].y,w[e].width,w[e].height);var t=n(c,w[e]);"l"===t||"r"===t?(c.velX=0,c.jumping=!1):"t"===t?c.velY*=-1:"b"===t&&(c.grounded=!0,c.jumping=!1);var r=n(x,w[e]);null!=r&&(c.shot=!1);var l=n(f,w[e]);null!=l&&(A.shot=!1);var C=n(b,w[e]);"l"===C||"r"===C||("t"===C?b.direction="down":"b"===C&&(b.direction="up"))}var F=n(c,g);null!=F&&(s="win");for(var e=0;e<v.length;e++){var t=n(c,v[e]);if(null!=t&&o(),v[e].mortal){var r=n(x,v[e]);"l"===r||"r"===r?(v[e].alive=!1,c.shot=!1):"t"===r?(v[e].alive=!1,c.shot=!1):"b"===r&&(v[e].alive=!1,c.shot=!1),v[e].alive||(v[e].x=-500,v[e].y=-500)}}for(var e=0;e<y.length;e++){var t=n(R,y[e]);"l"===t&&(R.direction="right"),"r"===t&&(R.direction="left");var X=n(S,y[e]);"l"===X&&(S.direction="right"),"r"===X&&(S.direction="left")}b.alive&&("down"===b.direction?b.y+=b.speed:"up"===b.direction&&(b.y-=b.speed)),R.alive&&("right"===R.direction?R.x+=R.speed:"left"===R.direction&&(R.x-=R.speed)),S.alive&&("right"===S.direction?S.x+=S.speed:"left"===S.direction&&(S.x-=S.speed)),A.alive&&A.shot===!1&&(f.x=A.x+40,f.y=A.y+15,A.shot=!0),A.shot&&(f.x+=f.speed),c.grounded&&(c.velY=0),c.x+=c.velX,c.y+=c.velY,c.shot&&("right"===x.direction?x.x+=x.speed:"left"===x.direction&&(x.x-=x.speed)),d.fill(),c.shot&&(d.fillStyle=x.color,d.fillRect(x.x,x.y,x.width,x.height)),d.fillStyle=b.color;for(var e=0;e<v.length;e++)d.fillRect(v[e].x,v[e].y,v[e].width,v[e].height);d.fillStyle=g.color,d.fillRect(g.x,g.y,g.width,g.height),d.fillStyle=c.color,d.fillRect(c.x,c.y,c.width,c.height),"win"===s&&(d.fillStyle="#000",d.fillRect(0,0,a,u),d.fillStyle="#fff",d.font="20pt Helvetica",d.textAlign="center",d.fillText("VICTORY",a/2,u/2),d.fillText("Press Space to Retry",a/2,u/2+40)),requestAnimationFrame(h)}function o(){c.x=0,c.y=u/2}function n(e,t){var i=e.x+e.width/2-(t.x+t.width/2),h=e.y+e.height/2-(t.y+t.height/2),o=e.width/2+t.width/2,n=e.height/2+t.height/2,r=null;if(Math.abs(i)<o&&Math.abs(h)<n){var l=o-Math.abs(i),d=n-Math.abs(h);l>=d?h>0?(r="t",e.y+=d):(r="b",e.y-=d):i>0?(r="l",e.x+=l):(r="r",e.x-=l)}return r}var r=!1;!function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=e}();var l,d,a,s,u,c,g,p,w,y,v,x,f,m,$,b,R,S,A,C;i(),document.body.addEventListener("keydown",function(e){p[e.keyCode]=!0}),document.body.addEventListener("keyup",function(e){p[e.keyCode]=!1}),e.$on("$routeChangeSuccess",function(){"game"==t.current.action&&(r===!1&&(r=!0,h()),i())})}]),app.controller("mainController",["$scope","$rootScope","$location","$route","$routeParams","$timeout","$resource",function(e,t,i,h){e.$on("$routeChangeSuccess",function(){e.currentView=h.current.action})}]);